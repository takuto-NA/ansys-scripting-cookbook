# ⚠️ 技術的な落とし穴と解決策 (Pitfalls)

Ansys スクリプト開発（特に IronPython）において、多くの開発者が遭遇する典型的な問題とその対策をまとめています。

## 1. 日本語パスとエンコーディング

### 問題
IronPython 2.7 はデフォルトで Unicode への対応が弱く、日本語を含むパスにあるファイルを `open()` しようとするとエラーになる場合があります。

### 対策
- スクリプトの 1 行目に `# -*- coding: utf-8 -*-` を必ず記述します。
- 日本語を含む文字列は `u"日本語"` のように `u` プレフィックスを付けます。
- VS Code で保存する際は、**UTF-8 (BOM付き)** で保存すると、Ansys 内部のエディタで文字化けしにくくなります。

## 2. 単位系の罠

### 問題
スクリプトから取得するプロパティ（例：`body.Volume`）の値は、**「その時の GUI の表示単位系」**に依存する場合と、**「システム内部単位 (SI)」**で固定されている場合があります。

### 対策
- `Quantity` クラスを使用して、明示的に単位を指定して取得・設定することを推奨します。
  ```python
  # 例: 単位を指定して力を設定
  force.Magnitude.Output.SetData("100 [N]")
  ```

## 3. `DataModel.GetObjectsByType` のパフォーマンス

### 問題
大規模なアセンブリに対して `GetObjectsByType` を頻繁に呼び出すと、処理が非常に重くなることがあります。

### 対策
- 可能な限り一度変数に格納して使い回すようにします。
- ツリー構造がわかっている場合は、`Model.Geometry.GetChildren(...)` などで探索範囲を絞ります。

## 4. 外部ライブラリの制限

### 問題
Ansys 内部の Python 環境には `numpy` や `pandas` などの標準的なデータ分析ライブラリは含まれていません。

### 対策
- 必要な計算は標準ライブラリ（`math` 等）のみで実装します。
- どうしても必要な場合は、一度 CSV 等に書き出し、外部の Python 3.x 環境で処理する等の設計を検討してください。

